<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.24.0 by Michael Rose
  Copyright 2013-2020 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE
-->
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>Week 17 - Balanceo del dataset - Robotics Lab URJC</title>
<meta name="description" content="(Recuperación) Entrenamiento del Modelo PilotNet Modificado para Inferir Steering, Throttle y Brake">


  <meta name="author" content="Carlos Velásquez">
  
  <meta property="article:author" content="Carlos Velásquez">
  


<meta property="og:type" content="article">
<meta property="og:locale" content="en_US">
<meta property="og:site_name" content="Robotics Lab URJC">
<meta property="og:title" content="Week 17 - Balanceo del dataset">
<meta property="og:url" content="http://localhost:4000/weekly%20log/week17/">


  <meta property="og:description" content="(Recuperación) Entrenamiento del Modelo PilotNet Modificado para Inferir Steering, Throttle y Brake">







  <meta property="article:published_time" content="2024-07-27T00:00:00-05:00">





  

  


<link rel="canonical" href="http://localhost:4000/weekly%20log/week17/">




<script type="application/ld+json">
  {
    "@context": "https://schema.org",
    
      "@type": "Person",
      "name": "Carlos Andrés Velásquez Ospina",
      "url": "http://localhost:4000/"
    
  }
</script>







<!-- end _includes/seo.html -->



  <link href="/feed.xml" type="application/atom+xml" rel="alternate" title="Robotics Lab URJC Feed">


<!-- https://t.co/dKP3o1e -->
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5/css/all.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
<noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5/css/all.min.css"></noscript>





    <!-- start custom head snippets -->

<!-- insert favicons. use https://realfavicongenerator.net/ -->

<!-- end custom head snippets -->

  </head>

  <body class="layout--single">
    <nav class="skip-links">
  <ul>
    <li><a href="#site-nav" class="screen-reader-shortcut">Skip to primary navigation</a></li>
    <li><a href="#main" class="screen-reader-shortcut">Skip to content</a></li>
    <li><a href="#footer" class="screen-reader-shortcut">Skip to footer</a></li>
  </ul>
</nav>

    

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        
          <a class="site-logo" href="/"><img src="/assets/images/logo.png" alt="Robotics Lab URJC"></a>
        
        <a class="site-title" href="/">
          Robotics Lab URJC
          <span class="site-subtitle">Programming Robot Intelligence</span>
        </a>
        <ul class="visible-links"><li class="masthead__menu-item">
              <a href="https://mmistakes.github.io/minimal-mistakes/docs/quick-start-guide/">Quick-Start Guide</a>
            </li></ul>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">Toggle menu</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>


    <div class="initial-content">
      





<div id="main" role="main">
  
  <div class="sidebar sticky">
  


<div itemscope itemtype="https://schema.org/Person" class="h-card">

  
    <div class="author__avatar">
      <a href="http://localhost:4000/">
        <img src="/assets/images/me.jpg" alt="Carlos Velásquez" itemprop="image" class="u-photo">
      </a>
    </div>
  

  <div class="author__content">
    <h3 class="author__name p-name" itemprop="name">
      <a class="u-url" rel="me" href="http://localhost:4000/" itemprop="url">Carlos Velásquez</a>
    </h3>
    
      <div class="author__bio p-note" itemprop="description">
        <p>Doctoral thesis blog</p>

      </div>
    
  </div>

  <div class="author__urls-wrapper">
    <button class="btn btn--inverse">Follow</button>
    <ul class="author__urls social-icons">
      
        <li itemprop="homeLocation" itemscope itemtype="https://schema.org/Place">
          <i class="fas fa-fw fa-map-marker-alt" aria-hidden="true"></i> <span itemprop="name" class="p-locality">Medellín</span>
        </li>
      

      
        
          
            <li><a href="mailto:canveo@gmail.com" rel="nofollow noopener noreferrer me"><i class="fas fa-fw fa-envelope-square" aria-hidden="true"></i><span class="label">Email</span></a></li>
          
        
          
            <li><a href="https://github.com/canveo" rel="nofollow noopener noreferrer me" itemprop="sameAs"><i class="fab fa-fw fa-github" aria-hidden="true"></i><span class="label">GitHub</span></a></li>
          
        
          
            <li><a href="https://www.linkedin.com/in/canveo/" rel="nofollow noopener noreferrer me" itemprop="sameAs"><i class="fab fa-fw fa-linkedin" aria-hidden="true"></i><span class="label">LinkedIn</span></a></li>
          
        
      

      

      
        <li>
          <a href="mailto:canveo@gmail.com" rel="me" class="u-email">
            <meta itemprop="email" content="canveo@gmail.com" />
            <i class="fas fa-fw fa-envelope-square" aria-hidden="true"></i><span class="label">Email</span>
          </a>
        </li>
      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      <!--
  <li>
    <a href="http://link-to-whatever-social-network.com/user/" itemprop="sameAs" rel="nofollow noopener noreferrer me">
      <i class="fas fa-fw" aria-hidden="true"></i> Custom Social Profile Link
    </a>
  </li>
-->
    </ul>
  </div>
</div>

  
  </div>



  <article class="page h-entry" itemscope itemtype="https://schema.org/CreativeWork">
    <meta itemprop="headline" content="Week 17 - Balanceo del dataset">
    <meta itemprop="description" content="(Recuperación) Entrenamiento del Modelo PilotNet Modificado para Inferir Steering, Throttle y Brake">
    <meta itemprop="datePublished" content="2024-07-27T00:00:00-05:00">
    

    <div class="page__inner-wrap">
      
        <header>
          <h1 id="page-title" class="page__title p-name" itemprop="headline">
            <a href="http://localhost:4000/weekly%20log/week17/" class="u-url" itemprop="url">Week 17 - Balanceo del dataset
</a>
          </h1>
          

  <p class="page__meta">
    

    

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-clock" aria-hidden="true"></i>
        
          3 minute read
        
      </span>
    
  </p>


        </header>
      

      <section class="page__content e-content" itemprop="text">
        
        <h2 id="recuperación-entrenamiento-del-modelo-pilotnet-modificado-para-inferir-steering-throttle-y-brake">(Recuperación) Entrenamiento del Modelo PilotNet Modificado para Inferir Steering, Throttle y Brake</h2>

<h3 id="preparación-de-los-datos">Preparación de los Datos</h3>
<p>Los datos utilizados para el entrenamiento del modelo incluyen imágenes del simulador CARLA y etiquetas correspondientes a los valores de dirección, aceleración y freno. Se realizaron varias transformaciones y balanceo de datos para asegurar una distribución adecuada de las muestras.</p>

<p>Transformaciones Aplicadas
Para aumentar la variabilidad y la robustez del modelo, se implementaron diversas transformaciones en las imágenes del dataset utilizando la biblioteca Albumentations. El objetivo principal de este proceso fue generar un conjunto de datos más variado a partir de las mismas imágenes originales, lo que permitió aumentar el tamaño del dataset y mejorar el rendimiento del modelo en distintas condiciones.</p>

<p>Las transformaciones aplicadas incluyeron:</p>

<p>Volteo horizontal: Para simular cambios de dirección y aumentar la diversidad de las muestras.
Ajustes de brillo y contraste: Simulando diferentes condiciones de iluminación.
Desplazamiento de gamma: Para modificar el brillo de manera no lineal y simular diferentes condiciones de luz.
Ajustes de tono, saturación y valor (HSV): Modificando el color de la imagen para simular cambios en las condiciones ambientales.
PCA (Principal Component Analysis) en colores: Utilizado para realizar perturbaciones sutiles en los colores, lo que genera una variabilidad cromática.
Desenfoque gaussiano: Para simular imágenes desenfocadas y ayudar al modelo a generalizar mejor en escenarios de visión limitada.
Estas transformaciones permitieron obtener un conjunto de datos más diverso y equilibrado, lo que contribuyó significativamente al entrenamiento del modelo al exponerlo a una mayor variedad de situaciones posibles.</p>

<h3 id="balanceo-de-datos">Balanceo de Datos</h3>
<p>Para evitar problemas de overfitting y mejorar la capacidad de generalización del modelo PilotNet, comenzamos reduciendo el dataset original en crudo, eliminando alrededor de 120,000 muestras en las que el valor del ángulo de dirección (steer angle) era igual a cero. Esto fue clave para evitar que el modelo aprendiera de manera desbalanceada a conducir en línea recta, lo cual hubiera limitado su rendimiento en situaciones más complejas.</p>

<p>Sin embargo, el conjunto de datos resultante seguía presentando un notable desequilibrio entre las clases que representan giros pronunciados y aquellas correspondientes a ángulos de dirección en rectas o curvas suaves. Para abordar este desbalance, implementamos una estrategia de resampling que replicó las muestras en los intervalos menos representados hasta alcanzar un número objetivo de aproximadamente 10,000 muestras por clase. Esto permitió mejorar la representación de giros más pronunciados y equilibrar el dataset, lo que resultó en un entrenamiento más robusto y adaptable a diferentes condiciones de conducción.</p>

<figure class="half">
  <img src="http://localhost:4000/assets/images/week17/histg_desbalanceado.png" alt="" style="width:100%" />
  <figcaption>histograma_desbalanceado</figcaption>
</figure>

<figure class="half">
  <img src="http://localhost:4000/assets/images/week17/recorte.png" alt="" style="width:100%" />
  <figcaption>histograma_desbalanceado</figcaption>
</figure>

<figure class="half">
  <img src="http://localhost:4000/assets/images/week17/balanceo.png" alt="" style="width:100%" />
  <figcaption>histograma_desbalanceado</figcaption>
</figure>

<h3 id="entrenamiento-del-modelo">Entrenamiento del Modelo</h3>
<p>El modelo fue entrenado utilizando el generador de datos definido para manejar las transformaciones y el balanceo de las muestras. Se utilizó la pérdida de error cuadrático medio (MSE) y el error absoluto medio (MAE) como métricas de evaluación.</p>

<figure class="half">
  <img src="http://localhost:4000/assets/images/week17/plot.png" alt="" style="width:100%" />
  <figcaption>plot</figcaption>
</figure>

<h3 id="resultados">Resultados</h3>
<p>Gráficos de Error (MAE y MSE)</p>

<p>Los gráficos muestran cómo el Error Absoluto Medio (MAE) y el Error Cuadrático Medio (MSE) evolucionan durante el entrenamiento y validación del modelo PilotNet. Ambos errores disminuyen rápidamente en las primeras épocas y luego se estabilizan, lo que indica que el modelo está aprendiendo de manera efectiva. Sin embargo, el error de validación es menor que el de entrenamiento, lo que sugiere que el modelo generaliza bien y no está sobreajustado.</p>

<p>Inferencias en imágenes de CARLA</p>

<p>Las imágenes muestran los resultados de las predicciones del modelo en comparación con los valores reales en situaciones del simulador CARLA. El modelo predice con precisión el ángulo de dirección Steer.</p>

<figure class="half">
  <img src="http://localhost:4000/assets/images/week17/inferencia.png" alt="" style="width:100%" />
  <figcaption>inferencia_images</figcaption>
</figure>

<figure class="half">
  <img src="http://localhost:4000/assets/images/week17/values.png" alt="" style="width:100%" />
  <figcaption>inferencia_values</figcaption>
</figure>

<p>–</p>

<table>
  <thead>
    <tr>
      <th><strong>Descripción</strong></th>
      <th><strong>Valor</strong></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><strong>Tamaño del dataset</strong></td>
      <td>433703 imágenes (resampled)</td>
    </tr>
    <tr>
      <td><strong>Learning Rate</strong></td>
      <td>0.0001</td>
    </tr>
    <tr>
      <td><strong>Batch size</strong></td>
      <td>32</td>
    </tr>
    <tr>
      <td><strong>Dropout</strong></td>
      <td>0.1</td>
    </tr>
    <tr>
      <td><strong>Image Shape</strong></td>
      <td>(66, 200, 3)</td>
    </tr>
    <tr>
      <td><strong>Métricas Usadas</strong></td>
      <td>Mean Squared Error (MSE), Mean Absolute Error (MAE)</td>
    </tr>
    <tr>
      <td><strong>Épocas Usadas</strong></td>
      <td>47</td>
    </tr>
  </tbody>
</table>

<h2 id="prueba-del-modelo">Prueba del modelo</h2>

<p>Durante las pruebas se utilizó Town02 como escenario de simulación. Aunque el modelo ha mostrado buen rendimiento en la mayoría de las situaciones, aún enfrenta dificultades en escenarios complejos, como las intersecciones. En estos puntos, el piloto tiende a desorientarse, ya que no está lo suficientemente entrenado para tomar decisiones adecuadas.</p>

<p>Para abordar este inconveniente, se está considerando el uso de información adicional proveniente del GPS. La idea es que, mientras se mejora el modelo para integrar la detección y manejo de intersecciones, el sistema pueda desactivar temporalmente el modelo entrenado y basar las decisiones en los datos del GPS, evitando errores en estas situaciones complicadas.</p>

<p>Este enfoque permitirá un mejor rendimiento del sistema de conducción autónoma en áreas donde la complejidad del entorno sobrepasa las capacidades actuales del modelo. A medida que se avanza, se planea entrenar el modelo con mayor información sobre intersecciones para que pueda resolver estos escenarios sin necesidad de intervención externa.</p>

<iframe width="1280" height="720" src="https://www.youtube.com/embed/bpI0FUXG6F0" title="Test pilotnet - Town02" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen=""></iframe>

        
      </section>

      <footer class="page__meta">
        
        
  


  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-tags" aria-hidden="true"></i> Tags: </strong>
    <span itemprop="keywords">
    
      <a href="/tags/#balanceo" class="page__taxonomy-item p-category" rel="tag">balanceo</a><span class="sep">, </span>
    
      <a href="/tags/#carla-0-9-14" class="page__taxonomy-item p-category" rel="tag">CARLA 0.9.14</a><span class="sep">, </span>
    
      <a href="/tags/#dataset" class="page__taxonomy-item p-category" rel="tag">Dataset</a><span class="sep">, </span>
    
      <a href="/tags/#pilotnet" class="page__taxonomy-item p-category" rel="tag">PilotNet</a><span class="sep">, </span>
    
      <a href="/tags/#tensorflow" class="page__taxonomy-item p-category" rel="tag">Tensorflow</a>
    
    </span>
  </p>




  


  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-folder-open" aria-hidden="true"></i> Categories: </strong>
    <span itemprop="keywords">
    
      <a href="/categories/#weekly-log" class="page__taxonomy-item p-category" rel="tag">weekly Log</a>
    
    </span>
  </p>


        

  <p class="page__date"><strong><i class="fas fa-fw fa-calendar-alt" aria-hidden="true"></i> Updated:</strong> <time class="dt-published" datetime="2024-07-27T00:00:00-05:00">July 27, 2024</time></p>

      </footer>

      <section class="page__share">
  
    <h4 class="page__share-title">Share on</h4>
  

  <a href="https://twitter.com/intent/tweet?text=Week+17+-+Balanceo+del+dataset%20http%3A%2F%2Flocalhost%3A4000%2Fweekly%2520log%2Fweek17%2F" class="btn btn--twitter" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Twitter"><i class="fab fa-fw fa-twitter" aria-hidden="true"></i><span> Twitter</span></a>

  <a href="https://www.facebook.com/sharer/sharer.php?u=http%3A%2F%2Flocalhost%3A4000%2Fweekly%2520log%2Fweek17%2F" class="btn btn--facebook" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Facebook"><i class="fab fa-fw fa-facebook" aria-hidden="true"></i><span> Facebook</span></a>

  <a href="https://www.linkedin.com/shareArticle?mini=true&url=http%3A%2F%2Flocalhost%3A4000%2Fweekly%2520log%2Fweek17%2F" class="btn btn--linkedin" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on LinkedIn"><i class="fab fa-fw fa-linkedin" aria-hidden="true"></i><span> LinkedIn</span></a>
</section>


      
  <nav class="pagination">
    
      <a href="/weekly%20log/week16/" class="pagination--pager" title="Week 16 - Prueba Detector de Carril con MobileV3Small
">Previous</a>
    
    
      <a href="/weekly%20log/week18/" class="pagination--pager" title="Week 18 - Detección de Cruces
">Next</a>
    
  </nav>

    </div>

    
  </article>

  
  
    <div class="page__related">
      <h2 class="page__related-title">You may also enjoy</h2>
      <div class="grid__wrapper">
        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/weekly%20log/week89/" rel="permalink">Week 89 - Robustez del piloto, Caso Canónico, 15 Casos y Pruebas de Velocidad
</a>
      
    </h2>
    

  <p class="page__meta">
    

    

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-clock" aria-hidden="true"></i>
        
          12 minute read
        
      </span>
    
  </p>


    <p class="archive__item-excerpt" itemprop="description">En esta entrada reporto los resultados de robustez en CARLA Town02 comparando cinco políticas/datasets bajo el mismo circuito de prueba, con 6 repeticiones p...</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/weekly%20log/week88/" rel="permalink">Week 88 - Actualización de métricas en BehaviorMetrics (CARLA), comparación contra ruta ideal
</a>
      
    </h2>
    

  <p class="page__meta">
    

    

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-clock" aria-hidden="true"></i>
        
          2 minute read
        
      </span>
    
  </p>


    <p class="archive__item-excerpt" itemprop="description">Actualización de métricas en BehaviorMetrics (CARLA)
</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/weekly%20log/week87/" rel="permalink">Week 87 - Actualización de métricas en CARLA
</a>
      
    </h2>
    

  <p class="page__meta">
    

    

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-clock" aria-hidden="true"></i>
        
          9 minute read
        
      </span>
    
  </p>


    <p class="archive__item-excerpt" itemprop="description">En esta semana consolidé el reporte comparativo de cinco variantes de entrenamiento (Burbuja, Noise injection, DAgger 16k, DAgger 27.6k y DAgger agresivo) us...</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/weekly%20log/week86/" rel="permalink">Week 86 - Actualización de métricas en CARLA
</a>
      
    </h2>
    

  <p class="page__meta">
    

    

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-clock" aria-hidden="true"></i>
        
          2 minute read
        
      </span>
    
  </p>


    <p class="archive__item-excerpt" itemprop="description">Se realizaron mejoras en la forma de reportar el desempeño del vehículo autónomo en simulación, con el objetivo de que las métricas reflejen con mayor fideli...</p>
  </article>
</div>

        
      </div>
    </div>
  
  
</div>

    </div>

    

    <div id="footer" class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        <div class="page__footer-follow">
  <ul class="social-icons">
    
      <li><strong>Follow:</strong></li>
    

    
      
        
      
        
      
        
      
        
      
        
      
        
      
    

    
      <li><a href="/feed.xml"><i class="fas fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li>
    
  </ul>
</div>

<div class="page__footer-copyright">&copy; 2026 Carlos Andrés Velásquez Ospina. Powered by <a href="https://jekyllrb.com" rel="nofollow">Jekyll</a> &amp; <a href="https://mademistakes.com/work/minimal-mistakes-jekyll-theme/" rel="nofollow">Minimal Mistakes</a>.</div>

      </footer>
    </div>

    
  <script src="/assets/js/main.min.js"></script>










  </body>
</html>

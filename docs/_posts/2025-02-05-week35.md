---
title: Week 35 - Prueba del modelo modifiedDeepestLSTM
categories:
    - weekly Log
tags:
    - CARLA Simulator
    - ROS 2
    - Lane Detection
    - TensorFlow
    - expertos
---

Este modelo se basa en la arquitectura presentada en el paper "Transferring Vision-Based End-to-End Autonomous Driving Decision-Making from Simulation to Real-World Vehicles", adaptado para mejorar su capacidad de generalizaci√≥n y robustez.

Para entrenarlo, se construy√≥ un dataset con 30,000 im√°genes, donde se aplic√≥ balanceo de datos en funci√≥n del valor de steer (direcci√≥n) y se utilizaron t√©cnicas de aumento de datos con Albumentations para mejorar la diversidad del conjunto de entrenamiento.

### Arquitectura del Modelo
El modelo modifiedDeepestLSTM es una red neuronal basada en visi√≥n con informaci√≥n auxiliar, dise√±ada para tareas de control en entornos aut√≥nomos. Su arquitectura se basa en:

1Ô∏è. **Bloque Convolucional Inicial:**

Capas Conv2D para extraer caracter√≠sticas espaciales de las im√°genes segmentadas.
Normalizaci√≥n con BatchNormalization().

2Ô∏è. **Bloque ConvLSTM:**

Uso de ConvLSTM2D para capturar la informaci√≥n temporal en secuencias de im√°genes.
Transformaci√≥n de la salida convolucional con Lambda() para garantizar compatibilidad con ConvLSTM2D().

3Ô∏è. **Fusi√≥n de Informaci√≥n Auxiliar:**

Se combinan las caracter√≠sticas visuales con entradas adicionales de velocidad y comandos.
4Ô∏è.  **Capa Densa:**

Capas Fully Connected (Dense) con activaciones ReLU.
Regularizaci√≥n con Dropout(0.2).

5Ô∏è. **Salidas del Modelo:**

Throttle (aceleraci√≥n) con activaci√≥n sigmoid.
Steering (direcci√≥n) con activaci√≥n tanh.
Brake (freno) con activaci√≥n sigmoid.


### Entradas (Inputs) del Modelo
El modelo recibe 4 entradas:

1Ô∏è. **Imagen Segmentada (input_image)**

Dimensi√≥n: (224, 224, 3).
Representa la vista procesada del entorno en escala de grises.

2Ô∏è. **Velocidad Actual (input_speed)**

Dimensi√≥n: (1,).
Indica la velocidad actual del veh√≠culo.
3Ô∏è. **Velocidad M√°xima Permitida (input_max_speed)**

Dimensi√≥n: (1,).
Establece un l√≠mite de velocidad que el veh√≠culo no debe superar.
4Ô∏è. **Comando de Alto Nivel (input_cmd)**

Dimensi√≥n: (4,).
Representa la intenci√≥n del veh√≠culo en un formato one-hot encoding con 4 posibles comandos (ir recto, girar izquierda, girar derecha, detenerse).


### Arquitectura del modelo

| Layer (type)          | Output Shape         | Param #  | Connected to           |
|----------------------|---------------------|----------|------------------------|
| **input_image** (InputLayer) | (None, 224, 224, 3)  | 0        | -                      |
| **conv2d** (Conv2D)         | (None, 110, 110, 24) | 1,824    | input_image[0][0]      |
| **conv2d_1** (Conv2D)       | (None, 53, 53, 36)   | 21,636   | conv2d[0][0]           |
| **conv2d_2** (Conv2D)       | (None, 25, 25, 48)   | 43,248   | conv2d_1[0][0]         |
| **batch_normalization** (BatchNormalization) | (None, 25, 25, 48) | 192  | conv2d_2[0][0] |
| **lambda** (Lambda)         | (None, 1, 25, 25, 48) | 0       | batch_normalization[0][0] |
| **conv_lstm2d** (ConvLSTM2D) | (None, 1, 25, 25, 64) | 258,304 | lambda[0][0] |
| **conv_lstm2d_1** (ConvLSTM2D) | (None, 25, 25, 64) | 295,168 | conv_lstm2d[0][0] |
| **flatten** (Flatten)       | (None, 40000)       | 0        | conv_lstm2d_1[0][0] |
| **input_speed** (InputLayer) | (None, 1)          | 0        | -                      |
| **input_max_speed** (InputLayer) | (None, 1)      | 0        | -                      |
| **input_cmd** (InputLayer)  | (None, 4)          | 0        | -                      |
| **concatenate** (Concatenate) | (None, 40006)    | 0        | flatten[0][0], input_speed[0][0], input_max_speed[0][0], input_cmd[0][0] |
| **dense** (Dense)           | (None, 100)        | 4,000,700 | concatenate[0][0] |
| **dense_1** (Dense)         | (None, 50)         | 5,050    | dense[0][0] |
| **dense_2** (Dense)         | (None, 10)         | 510      | dense_1[0][0] |
| **dropout** (Dropout)       | (None, 10)         | 0        | dense_2[0][0] |
| **throttle** (Dense)        | (None, 1)          | 11       | dropout[0][0] |
| **steering** (Dense)        | (None, 1)          | 11       | dropout[0][0] |
| **brake** (Dense)           | (None, 1)          | 11       | dropout[0][0] |

---
**üîπ Total de par√°metros:** `4,626,665` (‚âà17.65 MB)  
**üîπ Par√°metros entrenables:** `4,626,569`  
**üîπ Par√°metros no entrenables:** `96` (‚âà384 B)  


### Configuraci√≥n del Entrenamiento
El modelo fue compilado con:

* Optimizador:  Adam (learning_rate=0.0001)
* P√©rdida (Loss): MSE (Mean Squared Error) para cada salida.
* M√©tricas de Evaluaci√≥n:
    * Throttle: MSE, MAE
    * Steering: MSE, MAE
    * Brake: MSE, MAE
  
El entrenamiento se realiz√≥ en 120 √©pocas, con un tama√±o de batch de 32, utilizando im√°genes segmentadas y datos de simulaci√≥n.



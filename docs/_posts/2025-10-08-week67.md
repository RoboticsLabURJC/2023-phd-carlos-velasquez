---
title: Week 66 - MOnolitico vs expertos datadet teleoperado burbuja
categories:
    - weekly Log
tags:
    - CARLA Simulator
    - ROS 2
    - Python
---

| Métrica                                        | **Monolítico** | **MoE / Expertos** |
| ---------------------------------------------- | --------------------------------------------------: | --------------------------------------------------: |
| completed_distance (m) ↑                       |                                             753.215 |                                         **758.858** |
| **effective_completed_distance (m) ↑**         |                                           **307.0** |                                               216.0 |
| average_speed (m/s) ↑                          |                                              50.180 |                                          **51.754** |
| max_speed (m/s)                                |                                              71.831 |                                          **76.919** |
| min_speed (m/s) → 0 mejor                      |                                           -6.51e-08 |                                       **-5.91e-08** |
| suddenness_distance_speed (Σdist) ↓            |                                          **0.2679** |                                              0.5268 |
| suddenness_distance_control_commands (Σdist) ↓ |                                          **0.1197** |                                              0.1596 |
| suddenness_distance_throttle (Σdist) ↓         |                                          **0.0970** |                                              0.1489 |
| suddenness_distance_steer (Σdist) ↓            |                                              0.0492 |                                          **0.0260** |
| suddenness_distance_brake_command (Σdist) ↓    |                                             **0.0** |                                             **0.0** |
| collisions ↓                                   |                                               **0** |                                               **0** |
| lane_invasions ↓                               |                                               **0** |                                               **0** |
| experiment_total_simulated_time (s) ↓          |                                                  54 |                                              **53** |
| experiment_total_real_time (s) ↓               |                                         **112.710** |                                             112.885 |
| position_deviation_mean (m) ↓                  |                                           **0.882** |                                               1.083 |
| position_deviation_mean_per_km (m/km) ↓        |                                           **2.874** |                                               5.013 |
| suddenness_control_per_km ↓                    |                                           **0.390** |                                               0.739 |
| suddenness_throttle_per_km ↓                   |                                           **0.316** |                                               0.689 |
| suddenness_steer_per_km ↓                      |                                               0.160 |                                           **0.121** |
| suddenness_speed_per_km ↓                      |                                           **0.873** |                                               2.439 |

---

---


### Actualización del script de entrenamiento

Se optimizó el proceso de entrenamiento del modelo EfficientNet V2-S mejorando tanto la velocidad como la consistencia entre fases.

**Cambios principales:**

+ Nuevo recorte fijo de la calzada (top_ratio=0.4), eliminando zonas irrelevantes.

+ Normalización unificada (x/255 – 0.5)/0.5 para mantener coherencia entre train, test y piloto automático.

+ Uso de mixed precision (AMP), reduciendo a la mitad el tiempo de entrenamiento y el consumo de memoria.

+ Carga de datos optimizada con pin_memory y prefetch_factor.

**Resultado:**
Entrenamiento 2× más rápido, menor uso de GPU y datos mejor normalizados para una conducción más estable en CARLA.

---

### Adaptación de manual_control.py

El script original de CARLA fue modificado para convertirlo en una herramienta de recolección de datos y control manual más precisa:

+ Se integró la captura automática de imágenes RGB y segmentadas, junto con la grabación sincronizada de los valores de control (steer, throttle, brake).

+ Se mejoró la respuesta del joystick, ajustando la sensibilidad e implementando filtros suaves y zonas muertas para eliminar vibraciones y movimientos abruptos del timón.
De esta forma, los comandos del piloto humano se registran con mayor precisión, produciendo trayectorias más naturales y datos más útiles para el entrenamiento.

El nuevo manual_control.py combina una experiencia de conducción manual más fluida con un sistema de registro de datos robusto, mejorando significativamente la calidad del dataset y la estabilidad del modelo.


| Modelo                            | Steer MSE ↓ | Steer MAE ↓ | Throttle MSE ↓ | Throttle MAE ↓ |
| --------------------------------- | ----------- | ----------- | -------------- | -------------- |
| **DAgger agresivo (anterior)**    | 0.3391      | 0.2049      | 0.3997         | 0.3301         |
| **DAgger suave**                  | 0.2910      | 0.1995      | 0.4920         | 0.4778         |
| **Control manual (sin DAgger)**   | 0.0854      | 0.1650      | 0.2146         | 0.3936         |
| **Nuevo train — DAgger agresivo** | **0.4076**  | **0.2932**  | **0.3803**     | **0.2906**     |
